<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Attack Tree Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Vendor CSS: load JointJS first so our CSS can override it if needed -->
  <!-- For fully offline use, vendor these files locally (e.g., /vendor/jointjs.css) and update the href -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.7/joint.css" />

  <!-- App styles -->
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div id="app">

    <!-- Top toolbar (editor controls) -->
    <div id="toolbar">
      <button id="btn-new">New root</button>
      <button id="btn-add">Add node</button>
      <button id="btn-and">AND</button>
      <button id="btn-or">OR</button>
      <button id="btn-rename">Rename</button>
      <button id="btn-delete">Delete</button>
      <button id="btn-clear">Clear</button>

      <button id="btn-save" style="margin-left:auto;">Save</button>
      <button id="btn-load">Load</button>
      <span id="sel-label">No selection</span>
    </div>

    <!-- Study/status chip (session + study flow controls) -->
    <div id="study-toolbar" class="chip hidden">
      <span id="study-mode">mode: ?</span> ·
      <span id="study-scenario">scenario: ?</span>
      <!-- Study flow controls -->
      <button id="btn-start-assist">Start assist</button>
      <button id="btn-finish-assist">Finish &amp; snapshot</button>
      <button id="btn-download-log">Download log</button>
      <button id="btn-end-session">End session</button>
    </div>

    <!-- Canvas container (JointJS paper mounts here) -->
    <div id="paper-container"></div>

    <!-- Assistant panel (RQ1/RQ2/RQ3) -->
    <div id="kb-panel">
      <div class="tabs">
        <button data-tab="suggest" class="active">Suggest</button>
        <button data-tab="review">Review</button>
        <button data-tab="explain">Explain</button>
      </div>
      <div class="tab-body" id="tab-suggest"></div>
      <div class="tab-body hidden" id="tab-review"></div>
      <div class="tab-body hidden" id="tab-explain"></div>
    </div>

    <div id="session-modal" class="modal hidden">
  <div class="modal-card">
    <h3>Start Session</h3>

    <label>Participant ID
      <input id="part-id" placeholder="P01" />
    </label>

    <label>Session ID
      <input id="sess-id" placeholder="2025-08-27T12-00" />
    </label>

    <fieldset style="margin-top:10px">
      <legend style="font-size:12px;color:#a3a3a3">Choose scenario</legend>
      <label style="display:block;margin:4px 0">
        <input type="radio" name="scenario" value="auth" checked />
        1) University portal account takeover
      </label>
      <label style="display:block;margin:4px 0">
        <input type="radio" name="scenario" value="checkout" />
        2) Online shop: receive goods without paying
      </label>
      <label style="display:block;margin:4px 0">
        <input type="radio" name="scenario" value="iot" />
        3) Smart camera: view live feed without permission
      </label>
      <label style="display:block;margin:4px 0">
        <input type="radio" name="scenario" value="doc_link" />
        4) Private document link leakage
      </label>
      <label style="display:block;margin:4px 0">
  <input type="radio" name="scenario" value="sandbox" />
  5) Sandbox (no scenario)
</label>
    </fieldset>

    <div class="row" style="margin-top:10px">
      <button id="btn-start-session">Start</button>
    </div>
  </div>
</div>


    <!-- Scenario brief modal (shown before Baseline starts) -->
    <div id="brief-modal" class="modal hidden">
      <div class="modal-card">
        <h3>Scenario</h3>
        <p id="brief-text" style="white-space:pre-wrap;margin-top:6px;line-height:1.4"></p>
        <div class="row">
          <button id="btn-brief-start">Start baseline</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Scenario Guide: collapsed pill (bottom-right) that expands into a rich help card -->
<div id="scenario-help" class="help collapsed">
  <button id="help-toggle" aria-expanded="false" title="Show scenario guide">Scenario ▸</button>
  <div class="help-body" id="help-body">
    <div class="help-title">Scenario Guide</div>
    <div class="help-content" id="help-content">
      <!-- filled by study.js after Start Session -->
    </div>
  </div>
</div>

  <!-- end of #app -->

  <!-- Vendor scripts (CDN). For offline, vendor locally and update the src paths. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.5.0/backbone-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.7/joint.min.js"></script>

  <!-- App scripts -->

  <script src="js/utils.js"></script>
<script src="js/kb-core.js"></script>
<script src="js/kb-eval.js"></script>   
<script src="js/kb-woz.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder"></script>
<script src="js/kb-semantic.js"></script>

<script src="js/kb-ui.js"></script>
<script src="js/study.js"></script>
<script src="js/app.js"></script>
</body>
</html>
